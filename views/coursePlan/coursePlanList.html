<!DOCTYPE html>
<html >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>排课情况</title>
    <link href="../../css/global.css" rel="stylesheet" type="text/css" />
    <link href="../../css/index.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript">

        var courseId = '';//课程id
        var classRoomId = '';//教室id
        var courseArrayDate = '';//排课时间
        $(function (){

            $("#classForm tr td[class='classDefault']").html(function(){  //穿过子元素的时候不会触发
                $(this).mouseenter(function(){
                    $(this).append("<strong>点击添加</strong>");
                    $(this).click(function(){
                        var add_url = "/jinquan/course_plan_pre_add?courseId="+courseId+"&classRoomId="+classRoomId+'&date='+courseArrayDate+'&type=1';
                        window.location.href=add_url;
                    });
                }).mouseleave(function(){
                    $(this).empty();
                })
            });

            $("#classForm tr td[class='classBlue']").html(function(){  //穿过子元素的时候不会触发
                $(this).mouseenter(function(){
                    $(this).append("<strong>点击修改</strong>");
                    $(this).click(function(){
                        var edit_url = "/jinquan/course_plan_edit?courseId="+courseId+"&classRoomId="+classRoomId+'&date='+courseArrayDate;
                        window.location.href=edit_url;
                    });
                }).mouseleave(function(){
                    $(this).empty();
                })
            });

            $("#classForm tr td[class='classViolet']").html(function(){  //穿过子元素的时候不会触发
                $(this).mouseenter(function(){
                    $(this).append("<strong>点击修改</strong>");
                    $(this).click(function(){
                        var add_url = "/jinquan/course_plan_edit?courseId="+courseId+"&classRoomId="+classRoomId+'&date='+courseArrayDate;
                        window.location.href=edit_url;
                    });
                }).mouseleave(function(){
                    $(this).empty();
                })
            });

            $("#classForm tr td[class='classGreen']").html(function(){  //穿过子元素的时候不会触发
                $(this).mouseenter(function(){
                    $(this).append("<strong>点击修改</strong>");
                    $(this).click(function(){
                        var edit_url = "/jinquan/course_plan_edit?courseId="+courseId+"&classRoomId="+classRoomId+'&date='+courseArrayDate;
                        window.location.href=edit_url;
                    });
                }).mouseleave(function(){
                    $(this).empty();
                })
            });

            $("#classForm tr td[class='classRed']").html(function(){  //穿过子元素的时候不会触发
                $(this).mouseenter(function(){
                    $(this).append("<strong>点击修改</strong>");
                    $(this).click(function(){
                        var edit_url = "/jinquan/course_plan_edit?courseId="+courseId+"&classRoomId="+classRoomId+'&date='+courseArrayDate;
                        window.location.href=edit_url;
                    });
                }).mouseleave(function(){
                    $(this).empty();
                })
            });
        })

        /**
         * 鼠标移入事件
         * 当鼠标移入到某单元格时，显示修改或增加
         * @param id    课程id
         * @param classroomid    教室id
         * @param date    日期
         */
        function tdOnMouseOver(td,id,classroomid,date_index){
            courseId = id;//课程id
            classRoomId = classroomid;//教室id
            // date_index是索引
            var myDate = new Date();
            var year = myDate.getFullYear();
            var month = myDate.getMonth()+1;
            if (month<10){
                month = "0"+month;
            }
            var first_date = year +'-'+ month +'-01';

            var temp = new Date(first_date);
            temp.setDate(temp.getDate() + date_index);
            var temp_month = temp.getMonth() + 1;
            if (temp_month<10) {
                temp_month = '0'+temp_month;
            }
            var result = temp.getFullYear()+'-'+temp_month+'-'+temp.getDay();
            courseArrayDate = result;//排课时间
        }
    </script>
</head>

<body>
<div class="r_top">
    <div class="weizhi">
        当前位置：系统排课
    </div>
</div>
<div class="center_con">
    <div class="notes">
       <!-- <div class="button2"><button type="button" class="button gray">导出Excel</button></div> -->
        <ul class="noteUi">
            <li><span class="color1"></span>会议</li>
            <li><span class="color2"></span>催乳师专业课程</li>
            <li><span class="color3"></span>父母课程</li>
            <li><span class="color4"></span> 内训</li>
        </ul>
    </div>
    <div class="tabCon" style="clear:both;">
        <form id="classForm">
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="bordered">
                <thead>
                <tr>
                    <th width="10%">日期</th>
                    <th width="10%">教室编码</th>
                    <th width="7%">8:00~8:30</th>
                    <th width="7%">8:30~9:00</th>
                    <th width="7%">9:30~10:00</th>
                    <th width="7%">10:00~10:30</th>
                    <th width="7%">10:30~11:00</th>
                    <th width="7%">11:30~12:00</th>
                    <th width="7%">14:00~14:30</th>
                    <th width="7%">14:30~15:00</th>
                    <th width="7%">15:00~15:30</th>
                    <th width="7%">15:30~16:00</th>
                    <th width="7%">16:00~16:30</th>
                    <th width="7%">16:30~17:00</th>
                </tr>
                </thead>
                <tbody>
            <%

                for(var i = 0 ; i < data.dataArr.length ; i ++){

                    for(var j = 0 ; j < data.classRoomData.length ; j ++){//遍历教室
                        %>
                    <tr>
                        <%
                            if(j == 0){
                            %>
                            <input type="hidden" id="date" name="date" value="<%=data.dataArr[i]%>"/>
                            <input type="hidden" id="classroomId" name="classroomId" value="<%=data.classRoomData[j].id%>"/>
                            <td rowspan="<%=data.classRoomData.length%>"><%=data.dataArr[i]%></td>
                            <%
                            }
                        %>
                        <td><%=data.classRoomData[j].name%></td>
                        <%
                        for(var day = 0 ; day < 12 ; day++){//从8：00~8：30到16：30~17：00，共12个区域，用12表示
                            var isHaveCourse = '';
                            for(var k = 0 ; k < data.courseData.length ; k ++){//遍历每个课程
                                if(data.dataArr[i] == data.courseData[k].courseDate && data.classRoomData[j].id == data.courseData[k].classroomId){//如果遍历的时间和当前课程日期相同
                                    isHaveDate = '1';
                                    if(day >= data.courseData[k].courseTimeStart && day <= data.courseData[k].courseTimeEnd ){
                                        var tdClass = "classDefault";
                                        if(data.courseData[k].courseType == 1){
                                            tdClass = "classBlue";
                                        }else if(data.courseData[k].courseType == 2){
                                            tdClass = "classViolet";
                                        }else if(data.courseData[k].courseType == 3){
                                            tdClass = "classGreen";
                                        }else if(data.courseData[k].courseType == 4){
                                            tdClass = "classRed";
                                        }
                                        %><td class="<%=tdClass%>" onMouseOver="tdOnMouseOver(this,'<%=data.courseData[k].id%>','<%=data.classRoomData[j].id%>','<%=i%>')">&nbsp;</td><%
                                        isHaveCourse = '1';
                                        break;
                                    }
                                }
                            }
                            if(isHaveCourse == ''){
                                %><td class="classDefault" onMouseOver="tdOnMouseOver(this,'<%=data.classRoomData[j].id%>','<%=data.classRoomData[j].id%>','<%=i%>')">&nbsp;</td><%
                            }
                        }
                        %>
                    </tr>
                        <%
                    }
                }

            %>
                </tbody>
            </table>
        </form>
    </div>
</div>
</body>
</html>
